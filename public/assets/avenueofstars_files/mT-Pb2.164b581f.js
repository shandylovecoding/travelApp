(this.$WP=this.$WP||[]).push(["mT-Pb2",(e,n)=>{"use strict";var o,s,a,t,l,r,i,u,c,d,g,f,m,p,C,S,v,y,M,O,h,I,b,x,P=({onSuccess:e,onClose:n,variant:a})=>{var{funnelKey:t}=s(g),l={subscriberUrl:"/OptimusAccountManager",nonSubscriberUrl:`/OptimusSubscriptionCheckout?oik=${t}`};return o.createElement(c,{onClose:()=>{n&&n()}},o.createElement(d,{funnelKey:t,navigation:l,onLoginSuccess:()=>{e&&e()},variant:a}))},k=["OPTIMUS_BRANDED_IMAGE_HIGHLIGHT"],w=({allowClose:e,flow:n,forceLogin:l,contextualMessagingVariant:r,contextualMessageKey:c,contextualMessageParamKey:d,contextualMessageParam:g,contextualMessageSubheaderKey:p,isSignInOnly:y,onClose:M,onFailure:O,funnelKey:h,pid:I})=>{var{userId:b}=o.useContext(m),{login:x,close:w}=i(),[K,_]=o.useState({onClose:void 0,onSuccess:void 0}),L=(()=>{var{preferences:{currency:e}}=s(f),n=C({experimentKeys:["plus_login_improvement_1627576890"]}),o=n&&"test"===n.plus_login_improvement_1627576890,{getDiscountCode:a}=v(),t=a(),l=!t,{subscriptionPrice:r,fetching:i}=S(e,t,l);if(null===n||i)return null;var u=null==r?void 0:r.trialPeriod,c=((null==u?void 0:u.numberOfDays)||0)>0;return o?c?"testFreeTrial":"test":"control"})(),D=a((()=>{var e={contextualMessage:c,contextualMessageParamKey:d,contextualMessageParam:g,contextualMessageSubheader:p};return Object.assign({},r?{}:e,{isSignInOnly:y,contextualMessagingVariant:r,funnelKey:h})}),[c,g,d,p,r,y,h]),N=k.includes((n||"").toUpperCase()),B=u((()=>L&&"control"!==L?o.createElement(P,{variant:L,onClose:()=>{(null==K?void 0:K.onClose)&&K.onClose(),M&&M()},onSuccess:()=>{(null==K?void 0:K.onSuccess)&&K.onSuccess()}}):o.createElement(o.Fragment,null)),{},[K]),E=t((()=>(B.open(),_({onClose:()=>{B.close()},onSuccess:()=>{B.close()}}),Promise.resolve({userId:b,hasCreatedMember:null}))),[B,b,_]),A=t((o=>x({flowOrigin:"login",flow:n,isFullWidthMobile:!0,forceLogin:l,requireSecure:l,closeX:e,closeOnDocClick:e,hideBoxShadow:N,extraQueryParams:D,pid:I||40777,onSuccess:o||void 0,onClose:M,onFailure:O})),[e,D,N,n,l,x,M,O,I]);return null===L?{login:()=>{},close:()=>{}}:{login:"control"===L?A:E,close:w}},K=({members:e,nonMembers:n,messageVariant:o,onClose:a,flow:i="OPTIMUS_BRANDED",funnelKey:u,pid:c})=>{var{userId:d}=s(m),g=O(),f=y("phoenix_plus"),{login:p}=w(Object.assign({allowClose:!0,forceLogin:!1},o&&{flow:i,contextualMessagingVariant:o},{onClose:a,funnelKey:u,pid:c})),[C,S]=l(!1),{data:v,fetching:h}=M();return r((()=>{(d||f)&&C&&!h&&((null==v?void 0:v.isSubscribed)?g(e):g(n))}),[v,h,e,g,n,C,d,f]),t((()=>{d||f?S(!0):p((()=>{S(!0)}))}),[p,S,d,f])},_=()=>{var e=h(),[{page:n}]=s(p);return t((({locationId:o,listingKey:s=null,funnelKey:a})=>{if(!o||!a)throw new Error(`Unable to record user login. Missing offer data - ${JSON.stringify({locationId:o,funnelKey:a})}`);e({OptimusOffer:{optimusInitialOfferSignedIn:{servletName:n,locationId:o,funnelKey:a,listingKey:s}}})}),[e,n])},L="PlusHadBlockedCards",D=({children:e,forceLogin:n,loginContextualMessageKey:o,shouldLogoutAfterPaymentFailures:a=!1,renderBeforeLogout:i})=>{var[u,c]=l(!n),[d,g]=l(!1),[f]=s(p),{failedCardPayment:C,hasBlockedCardInSession:S,hadBlockedCard:v,clearAllBlockedCards:y}=(()=>{var[e,n]=l(!1),[o,s]=l(new Map);return{failedCardPayment:t((a=>{if(a&&!e){var t=o.get(a);t||(t=0),(t+=1)>=5&&(n(!0),I.set(L,!0),t=0),s(new Map(o.set(a,t)))}}),[e,n,o]),hasBlockedCardInSession:t((()=>e),[e]),hadBlockedCard:t((()=>!!e||I.has(L)),[e]),clearAllBlockedCards:t((()=>{e&&n(!1),I.has(L)&&I.remove(L)}),[e,n])}})(),M=v()?"plus_too_many_failed_payments":o,{login:O}=w({allowClose:!1,forceLogin:n,contextualMessageKey:M}),{userId:h}=s(m);r((()=>{h&&u||d||(g(!0),O((()=>c(!0))).finally((()=>g(!1))))}),[O,u,d,h]);var b=t((()=>{window.location=`/RegistrationController?flow=${encodeURIComponent("SIGN_OUT")}&pid=${encodeURIComponent(String(w))}&returnTo=${encodeURIComponent(f.path)}&fullscreen=true`}),[f.path]),x=a&&S();return r((()=>{x&&b()}),[x,b]),x?i?i():null:h&&u?(y(),e({userId:h,failedCardPayment:C})):null},N=e=>!!(null==e?void 0:e.canAccessSecureContent),B=({children:e,contextualMessageKey:n,renderNotSecure:o,skip:a})=>{var{login:t,close:i}=w({allowClose:!1,forceLogin:!0,contextualMessageKey:n}),[{data:u,fetching:c},d]=(()=>{var{userId:e}=s(m),[n,o]=l(null),[a,t]=b({query:x,pause:!e},N);return r((()=>{e!==n&&(o(e),t())}),[t,n,e]),r((()=>()=>o(null)),[o]),[a,t]})(),[g,f]=l(!1);return r((()=>{u||c||g||a||t((()=>{d(),f(!0)}))}),[u,d,c,t,g,f,a]),r((()=>()=>i()),[i]),u||a?e():o?o():null};return[()=>{(x=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"CanAccessSecureContent"},"variableDefinitions":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"canAccessSecureContent"},"name":{"kind":"Name","value":"OptimusBenefits_canAccessSecureContent"},"arguments":[],"directives":[]}]}}],"loc":{"start":0,"end":106}}')).__key=0xb7349ab36c89,e({OptimusHardGate:D,OptimusSecureLoginGate:B,useOptimusLogin:w,useOptimusLoginNavigation:K,useOptimusLoginTracking:_})},[e=>(o=e,s=e.useContext,a=e.useMemo,t=e.useCallback,l=e.useState,r=e.useEffect),e=>i=e.default,e=>u=e.useVDOMPortal,e=>c=e.ModalContainer,e=>d=e.default,e=>g=e.FunnelTracking,e=>(f=e.TravelInfo,m=e.Visitor,p=e.Route),e=>C=e.default,e=>S=e.useOptimusSubscriptionPriceQuery,e=>v=e.useDiscountCodePersistance,e=>y=e.featureIsEnabled,e=>M=e.useOptimusSubscriptionStatusRaw,e=>O=e.useNavigate,e=>h=e.useInteractionLogger,e=>I=e.default,e=>b=e.default]]},["cDcdfi","VANuRt","vq6MSq","E1X9WP","gNyFpr","ETqDaL","2R4xv2","S-RL4Q","BWm3Dg","P89JOf","-i3PJS","-WwUo-","1yEXVQ","fsml46","jaCyxS","kYmwth"]]);
